<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Biking</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link
    rel="stylesheet"
    href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
    integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf"
    crossorigin="anonymous"
  />
      <!--Import materialize.css-->
      <link type="text/css" rel="stylesheet" href="./assets/css/materialize.min.css"  media="screen,projection"/>
      <link href="./assets/css/activity.css" rel="stylesheet">
     
</head>
<body>
        <ul id="dropdown1" class="dropdown-content">
                <li><a href="#!">one</a></li>
                <li><a href="#!">two</a></li>
                <li class="divider"></li>
                <li><a href="#!">three</a></li>
              </ul>
              <nav>
                <div class="nav-wrapper white lighten-1">
                  &nbsp;&nbsp;&nbsp;&nbsp;<a href="./index.html" class="brand-logo black-text">Home</a>
                  <a href="#" data-target="mobile-demo" class="sidenav-trigger">
                    <i class="material-icons" style="color: black;">menu</i>
               </a>
                  <ul class="right hide-on-med-and-down">
                    <li><a class="black-text" href="./camping.html">Camping</a></li>
                    <li class="active"><a class="black-text" href="./biking.html">Biking</a></li>
                    <li><a class="black-text" href="./hiking.html">Hiking</a></li> 
                    <!-- Dropdown Trigger -->
                    <li><a class="dropdown-trigger black-text" href="#!" data-target="dropdown1">Favorites<i class="material-icons right">arrow_drop_down</i></a></li>
                  </ul>
                </div>
              </nav>
              
    <ul class="sidenav" id="mobile-demo">
      <li><a class="black-text" href="./camping.html">Camping</a></li>
      <li><a class="black-text" href="./biking.html">Biking</a></li>
      <li class="active"><a class="black-text" href="./hiking.html">Hiking</a></li>  
      <!-- <li><a class="dropdown-trigger black-text" href="#!" data-target="dropdown1">Favorites<i class="material-icons right">arrow_drop_down</i></a></li> -->
    </ul>

    <div class="container formBikeContainer">
        <div class="row">
                <form class="col s12">
                  <div class="row valign-wrapper">
                      
                    <div class="input-field col s8 offset-s2 bikeForm">
                       
                      <input id="input_text" class="cityInput white-text" type="text" >
                      <label for="input_text" class="white-text">City</label>
                      <form action="#">
                            <p class="range-field">
                                <label for="mileRange" class="white-text">Mile Radius</label>
                              <input type="range" id="test5"  class="mileRange" min="0" max="200" />
                            </p>
                            <p class="range-field">
                                <label for="bikeRange" class="white-text">Number of Search Results</label>
                              <input type="range" id="test5" class="bikeRange"  min="0" max="500" />
                            </p>
                            <p class="white-text"> Sort By: 
                                    <label>
                                      <input class="with-gap" name="group1" id="qualityInput" type="radio" checked />
                                      <span class="white-text">Quality</span>
                                    </label>
                                  
                                    <label>
                                      <input class="with-gap" name="group1" type="radio" />
                                      <span class="white-text">Distance</span>
                                    </label>
                                  </p>
                          </form>
                          <a class="waves-effect waves-light btn-large" id="bikeSubmit">Search</a>
                          
                    </div>
                  </div>
                </form>
        </div> 
    </div>
        <div class="row">
            <div class="col s12" id="bike-dump">
                     <!-- bike results get dumped here -->
            </div>
        </div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script type="text/javascript">


function displayBikingInfo() {
    $("#bike-dump").empty();

var city = $(".cityInput").val().trim();

var weatherAPIKey = "1e2baac35502ada6a2f1228a812729b7";

var queryURL = "https://api.openweathermap.org/data/2.5/weather?q=" + city + "&appid=" + weatherAPIKey;
 
 // calling weather api to get lon and lat for biking call
 $.ajax({
   url: queryURL,
   method: "GET"
 }).then(function(response) {
var lat = response.coord.lat;
var lon = response.coord.lon;
var maxResults = $(".bikeRange").val();
var maxDistance = $(".mileRange").val();
var qualityRadio = document.getElementById("qualityInput");

if (qualityRadio.checked) {
var queryBike = "https://www.mtbproject.com/data/get-trails?lat=" + lat + "&lon=" + lon + "&sort=quality&maxDistance="+ maxDistance +"&maxResults=" + maxResults + "&key=200651509-b2d4e44c77d481408ef6c9b2624e924c"
 } else {
  var queryBike = "https://www.mtbproject.com/data/get-trails?lat=" + lat + "&lon=" + lon + "&sort=distance&maxDistance="+ maxDistance +"&maxResults=" + maxResults + "&key=200651509-b2d4e44c77d481408ef6c9b2624e924c"
 }

$.ajax({
  url: queryBike,
  method: "GET"
}).then(function(response) {
    

    for(var j = 0; j < response.trails.length; j++) {

var bike = $("<div id='bikeDiv'>")
var bikeName = response.trails[j].name;
var bikeHeading = $("<h4>").text(bikeName);
bike.append(bikeHeading);

var bikingImg = $("<p><img src=" + response.trails[j].imgSmall + "></p>");
bike.append(bikingImg);


var bikeLocation = $("<p class='location'>").text(response.trails[j].location);
bike.append(bikeLocation);

var hikingSummary = response.trails[j].summary;
var hikingSummaryP = $("<p>").text(hikingSummary);
bike.append(hikingSummaryP);


 var bikeLink = response.trails[j].url;
 var bikeLinkP = $("<a href=" + bikeLink + "> click here to see more!</a>")
 bike.append(bikeLinkP);

//  var addFav = $("<p class='add-favorite'>Add to Favorites! <i class='far fa-star'></i></p>");
//  bike.append(addFav);

 $("#bike-dump").append(bike);
 $(".cityInput").val("");
    }

});

 });
};

$("#bikeSubmit").on("click", function(event) {
        event.preventDefault();
        displayBikingInfo();
});

$( document ).ready(function() {$(".dropdown-trigger").dropdown()});     
        </script>
     <script type="text/javascript" src="./assets/js/materialize.min.js"></script>
</body>
</html>